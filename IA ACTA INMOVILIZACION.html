<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACTA INMOVILIZACI√ìN (FINAL V22 - MARCO SUBIDO + TASAS LIMPIAS)</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* ESTILOS BASE */
        * { box-sizing: border-box; }
        body { background-color: #374151; height: 100vh; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; }
        
        .app-layout { display: flex; height: 100vh; overflow: hidden; }
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        
        .sheets-container {
            flex: 1; overflow-y: auto; display: flex; flex-direction: column; align-items: center;
            gap: 30px; padding: 30px 0; background-color: #6b7280;
        }

        .page-a4 {
            width: 210mm; height: 297mm; min-height: 297mm; background: white; padding: 5mm 10mm; 
            box-shadow: 0 0 25px rgba(0,0,0,0.5); display: flex; flex-direction: column; 
            position: relative; overflow: hidden; flex-shrink: 0;
        }

.page-a4 > * {
    margin-bottom: 10mm;
}


        /* ZONAS IA DRAG & DROP */
        .drop-zone-person { transition: all 0.2s; position: relative; }
        .drop-zone-vehicle { transition: all 0.2s; position: relative; }

        .drop-zone-person.drag-active { background-color: rgba(34, 197, 94, 0.1); outline: 2px dashed #22c55e; }
        .drop-zone-vehicle.drag-active { background-color: rgba(59, 130, 246, 0.1); outline: 2px dashed #3b82f6; }

        .loading-overlay { position: absolute; inset: 0; background: rgba(255,255,255,0.9); z-index: 50; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { width: 40px; height: 40px; border: 4px solid #e5e7eb; border-top: 4px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* FORMULARIO */
        .form-container { border: 2px solid black; width: 100%; display: flex; flex-direction: column; background: white; font-size: 10px; flex-grow: 1; }
        
        .section-header { 
            background-color: #d1d5db; border-top: 1px solid black; border-bottom: 1px solid black;
            font-weight: 900; font-size: 10px; padding: 1px 5px; width: 100%; text-transform: uppercase;
            display: flex; justify-content: space-between; align-items: center;
        }

        .acta-row { display: flex; width: 100%; border-bottom: 1px solid #ccc; min-height: 18px; align-items: center; }
        .acta-row.last { border-bottom: none; }
        
        .field-box { position: relative; display: flex; align-items: center; padding: 0 4px; border-right: 1px solid #ccc; height: 100%; }
        .field-box.no-border { border-right: none; }

        .label { font-weight: 800; margin-right: 4px; white-space: nowrap; font-size: 10px; }
        .input-data { 
            flex: 1; width: 100%; font-family: 'Courier New', monospace; font-weight: 600; 
            background: transparent; border: none; outline: none; font-size: 12px; color: #000;
        }

        /* CHECKBOXES */
        .checkbox-grid { display: flex; flex-direction: column; gap: 0px; }
        .checkbox-row { display: flex; align-items: center; gap: 4px; cursor: pointer; margin-bottom: 0px; padding: 1px 0; }
        .custom-box { 
            width: 11px; height: 11px; border: 1px solid black; display: flex; 
            align-items: center; justify-content: center; font-size: 9px; font-weight: bold; line-height: 1;
        }
        
        /* HEADER PERSONALIZADO */
        .header-custom { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 2px; border-bottom: 2px solid black; padding-bottom: 2px; }
        .header-left { display: flex; gap: 10px; align-items: center; flex: 1; }
        .header-right { display: flex; gap: 10px; align-items: center; text-align: right; }
        .logo-img { width: 70px; height: 70px; object-fit: contain; cursor: pointer; }
        
        /* --- LAYOUT ACTUACI√ìN PRACTICADA --- */
        .actuacion-grid {
            display: grid;
            grid-template-columns: 1fr 260px;
            flex-grow: 0; 
            border-bottom: 1px solid #ccc;
            overflow: hidden;
        }

        /* Columna Izquierda */
        .left-column-content {
            display: flex;
            flex-direction: column;
            border-right: 1px solid black;
            height: 100%; 
        }

        .motivos-container {
            padding: 3px 5px;
            flex-shrink: 0; 
        }

        /* ZONA FOTO EVIDENCIA */
        .evidence-zone-left {
            position: relative;
            height: 240px; 
            width: 100%;
            border-top: 1px solid #ccc;
            background: #f8fafc;
            overflow: hidden; 
            cursor: pointer;
            padding: 0;
            display: block;
        }
        .evidence-zone-left.drag-active { background-color: rgba(234, 179, 8, 0.1); outline: 2px dashed #eab308; border-top: none; }
        
        .evidence-img { 
            position: absolute;
            top: 2mm; left: 2mm; width: calc(100% - 4mm); height: calc(100% - 4mm); 
            object-fit: contain; display: block;
        }

        .evidence-placeholder-container { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .evidence-placeholder { color: #9ca3af; font-size: 10px; font-weight: bold; text-align: center; pointer-events: none; }

        /* Columna Derecha */
        .right-column-container {
            display: flex; 
            flex-direction: column;
            background-color: #e5e7eb;
            height: 100%;
            overflow: hidden;
        }
        
        .tasas-box {
            padding: 5px; 
            font-size: 10px;
            background-color: #e5e7eb;
            flex-grow: 1; 
            display: flex; flex-direction: column; justify-content: flex-start; 
            text-align: center;
        }

        /* ZONA DESTINO + OBS + LOGO */
        .bottom-section { display: flex; border-bottom: 1px solid black; flex-shrink: 0; }
        .bottom-left { flex: 1; display: flex; flex-direction: column; border-right: 1px solid black; }
        .bottom-right-logo { 
            width: 140px; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; cursor: pointer; padding: 5px;
        }
        .location-img { width: 100%; height: 100%; object-fit: contain; max-height: 80px; }
        .location-text { font-weight: 900; font-size: 8px; text-align: center; margin-top: 4px; }

        /* DILIGENCIA */
        .dotted-line {
            border-bottom: 1px dotted black; display: inline-block; text-align: center;
            font-family: 'Courier New', monospace; font-weight: bold; font-size: 11px;
            margin: 0 2px; line-height: 1.1; vertical-align: bottom;
        }

        .ia-badge { 
            background: #3b82f6; color: white; padding: 1px 4px; border-radius: 4px; 
            font-size: 8px; font-weight: bold; pointer-events: none; opacity: 0.7;
        }

        /* --- IMPRESI√ìN --- */
        @media print {
            /* 1. Eliminar m√°rgenes del navegador */
            @page { margin: 0; size: A4; }
            
            /* 2. Limpieza total de contenedores */
            body, html, #root, .app-layout, .main-content {
                width: 100%; height: 100%; margin: 0; padding: 0;
                overflow: hidden !important; 
                background: white;
            }
            
            .sheets-container {
                display: block; width: 100%; margin: 0; padding: 0; 
                overflow: hidden !important; background: white;
            }

            .page-a4 {
                width: 210mm; height: 297mm; 
                margin: 0 auto; 
                /* AQU√ç EST√Å EL CAMBIO: padding-bottom 15mm para subir la l√≠nea final 0.5cm */
                padding: 5mm 10mm 25mm 10mm !important; 
                box-shadow: none; border: none;
                overflow: hidden;
            }

            /* Ocultar interfaz */
            .sidebar, .toolbar, .no-print, .ia-badge, ::-webkit-scrollbar { display: none !important; }
            
            .section-header, .right-column-container, .tasas-box { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .evidence-placeholder { display: none !important; }
            .evidence-zone-left { border: none !important; background: transparent !important; border-top: 1px solid black !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- CONSTANTES ---
        const SHIFT_MORNING = { a1: "G-118", a2: "G-448", ind: "LINCE-10" };
        const SHIFT_AFTERNOON = { a1: "G-279", a2: "G-496", ind: "LINCE-20" };

        const formatToDateInit = (value) => {
            if(!value) return "";
            let cleaned = value.replace(/-/g, '/').replace(/[^\d]/g, '');
            cleaned = cleaned.substring(0, 8);
            if (cleaned.length > 2 && cleaned.length <= 4) return `${cleaned.substring(0, 2)}/${cleaned.substring(2)}`;
            else if (cleaned.length > 4) return `${cleaned.substring(0, 2)}/${cleaned.substring(2, 4)}/${cleaned.substring(4)}`;
            return cleaned;
        };

        const AutoInput = ({ value, onChange, width, isDate, center, placeholder }) => {
            const handleBlur = (e) => {
                if(isDate) {
                     let val = e.target.value.replace(/\D/g, '').slice(0, 8);
                     if (val.length >= 6) onChange(`${val.slice(0, 2)}/${val.slice(2, 4)}/${val.slice(4)}`);
                }
            };
            return <input className="input-data" placeholder={placeholder} style={{width: width, textAlign: center ? 'center' : 'left'}} value={value || ''} onChange={(e)=>onChange(e.target.value)} onBlur={handleBlur} autoComplete="off" />;
        };
        
        const DottedInput = ({ value, onChange, width }) => (
            <input className="dotted-line bg-transparent outline-none" style={{width: width}} value={value || ''} onChange={(e)=>onChange(e.target.value)} />
        );

        const App = () => {
            const [formData, setFormData] = React.useState({});
            const [logos, setLogos] = React.useState({ left: 'judicial.png', right: 'logogad.png', ubicacion: 'ubicaciondeposito.png' });
            
            // IA STATES
            const [apiKey, setApiKey] = React.useState(localStorage.getItem('ai_api_key') || '');
            const [geminiModelName, setGeminiModelName] = React.useState(localStorage.getItem('gemini_model_name') || 'gemini-1.5-flash'); 
            const [showKeyInput, setShowKeyInput] = React.useState(false);
            const [processing, setProcessing] = React.useState({active: false, msg: ''});
            const [dragTarget, setDragTarget] = React.useState(null);

            React.useEffect(() => {
                const now = new Date();
                const currentHour = now.getHours();
                
                let indicativo = "LINCE-";
                let agente1 = "", agente2 = "";

                if (currentHour >= 6 && currentHour < 14) { 
                    indicativo = "LINCE-10"; agente1 = SHIFT_MORNING.a1; agente2 = SHIFT_MORNING.a2; 
                } else if (currentHour >= 14 && currentHour < 22) { 
                    indicativo = "LINCE-20"; agente1 = SHIFT_AFTERNOON.a1; agente2 = SHIFT_AFTERNOON.a2; 
                }

                setFormData({
                    fecha: formatToDateInit(`${String(now.getDate()).padStart(2,'0')}${String(now.getMonth()+1).padStart(2,'0')}${now.getFullYear()}`),
                    hora: now.toLocaleTimeString('es-ES', {hour:'2-digit', minute:'2-digit'}),
                    lugar: "Polic√≠a Local de Alicante",
                    agente1, agente2, indicativo, unidad: "GAD",
                    destino_texto: "Dep√≥sito Municipal de Babel en c/ Metalurgias de Alicante"
                });

                const l = JSON.parse(localStorage.getItem('mis_logos_inmovilizacion'));
                if(l) setLogos(l);
                
                const savedModel = localStorage.getItem('gemini_model_name');
                if (savedModel) setGeminiModelName(savedModel);
            }, []);

            const handleChange = (k, v) => setFormData(p => ({...p, [k]: v}));
            const toggle = (k) => setFormData(p => ({...p, [k]: !p[k]}));
            const handleLogo = (e, k) => {
                const f = e.target.files[0];
                if(f) { 
                    const r = new FileReader(); 
                    r.onload = (ev) => { 
                        const n = {...logos, [k]: ev.target.result}; 
                        setLogos(n); 
                        localStorage.setItem('mis_logos_inmovilizacion', JSON.stringify(n)); 
                    }; 
                    r.readAsDataURL(f); 
                }
            };

            const saveSettings = (key, model) => {
                setApiKey(key); 
                setGeminiModelName(model);
                localStorage.setItem('ai_api_key', key);
                localStorage.setItem('gemini_model_name', model);
            };

            const callAI = async (base64Image, zone) => {
                if (!apiKey) { alert("Configura tu API Key primero en el men√∫ lateral."); return; }
                
                let prompt = "";
                if (zone === 'person') prompt = `Analiza documento identidad. JSON keys: { "nombre": "Nombre Apellidos", "dni": "DNI/NIE", "nacimiento": "Fecha Nacimiento DD/MM/AAAA", "domicilio": "Direcci√≥n completa", "municipio": "Municipio", "provincia": "Provincia" }.`;
                else if (zone === 'vehicle') prompt = `Analiza documento veh√≠culo. JSON keys: { "matricula": "Matr√≠cula", "marca": "Marca", "modelo": "Modelo", "vin": "N√∫mero Bastidor VIN" }.`;

                setProcessing({active: true, msg: `Analizando con ${geminiModelName}...`});
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${geminiModelName}:generateContent?key=${apiKey}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }, { inline_data: { mime_type: "image/jpeg", data: base64Image } }] }] })
                    });
                    const data = await response.json();
                    if (data.error) throw new Error(data.error.message);
                    const text = data.candidates[0].content.parts[0].text.replace(/```json|```/g, '').trim();
                    const json = JSON.parse(text);
                    
                    setFormData(prev => {
                        const next = { ...prev };
                        Object.keys(json).forEach(k => { if(json[k]) next[k] = json[k]; });
                        return next;
                    });
                } catch (e) { alert("Error IA (" + geminiModelName + "): " + e.message + "\n\nCONSEJO: Verifica que el nombre del modelo sea 'gemini-1.5-flash' en Configuraci√≥n."); }
                finally { setProcessing({active: false, msg: ''}); setDragTarget(null); }
            };

            const handleDrop = (e, zone) => {
                e.preventDefault(); e.stopPropagation(); setDragTarget(null);
                const file = e.dataTransfer.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        if (zone === 'evidence') {
                            setFormData(prev => ({...prev, evidence_image: ev.target.result}));
                        } else {
                            callAI(ev.target.result.split(',')[1], zone);
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };

            const pasteImage = async (zone) => {
                try {
                    const items = await navigator.clipboard.read();
                    for (const item of items) {
                        if (item.types.some(t => t.startsWith('image/'))) {
                            const blob = await item.getType(item.types.find(t => t.startsWith('image/')));
                            const reader = new FileReader();
                            reader.onload = (ev) => {
                                if (zone === 'evidence') {
                                    setFormData(prev => ({...prev, evidence_image: ev.target.result}));
                                } else {
                                    callAI(ev.target.result.split(',')[1], zone);
                                }
                            };
                            reader.readAsDataURL(blob);
                            return;
                        }
                    }
                    alert("No hay imagen en portapapeles");
                } catch (e) { alert("Error al pegar: " + e.message); }
            };

            const handleEvidenceClick = () => document.getElementById('evidenceInput').click();
            const handleEvidenceFile = (e) => {
                const file = e.target.files[0];
                if(file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => setFormData(prev => ({...prev, evidence_image: ev.target.result}));
                    reader.readAsDataURL(file);
                }
            }

            const deleteEvidence = (e) => {
                e.stopPropagation();
                setFormData(prev => ({...prev, evidence_image: null}));
            };

            return (
                <div className="app-layout">
                    
                    <div className="sidebar w-64 bg-gray-900 text-white p-4 flex flex-col gap-2 overflow-y-auto shrink-0 border-r border-gray-700 no-print">
                        <h2 className="text-lg font-bold text-green-400">Configuraci√≥n</h2>
                         <div className="mt-2 border-t border-gray-700 pt-4">
                            <button onClick={()=>setShowKeyInput(!showKeyInput)} className="text-xs text-yellow-400 hover:text-yellow-300 font-bold w-full text-left flex justify-between">
                                ‚öôÔ∏è CONFIGURAR IA <span>{showKeyInput ? '‚ñº' : '‚ñ∂'}</span>
                            </button>
                            {showKeyInput && (
                                <div className="mt-2 bg-gray-800 p-2 rounded border border-gray-600 space-y-2">
                                    <label className="text-[10px] text-gray-400">API Key:</label>
                                    <input type="password" value={apiKey} onChange={(e)=>saveSettings(e.target.value, geminiModelName)} className="w-full bg-gray-900 text-white text-xs p-1 rounded border border-gray-700" placeholder="Pegar API Key..." />
                                    <label className="text-[10px] text-gray-400 mt-1 block">Modelo Lenguaje:</label>
                                    <input type="text" value={geminiModelName} onChange={(e)=>saveSettings(apiKey, e.target.value)} className="w-full bg-gray-900 text-white text-xs p-1 rounded border border-gray-700" placeholder="Ej: gemini-1.5-flash" />
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="main-content bg-gray-200">
                        <div className="toolbar bg-white p-2 shadow flex justify-between items-center z-50 h-14 no-print">
                            <div className="font-bold text-gray-700 text-sm flex items-center gap-2">
                                <span>ACTA INMOVILIZACI√ìN + IA</span>
                                <span className={`text-[9px] px-1.5 py-0.5 rounded border ${apiKey ? 'bg-green-100 text-green-700 border-green-300' : 'bg-red-100 text-red-700 border-red-300'}`}>
                                    {geminiModelName.toUpperCase()}
                                </span>
                            </div>
                            <div className="flex gap-2 items-center">
                                <button onClick={()=>window.print()} className="bg-gray-800 text-white px-4 py-1.5 rounded text-sm hover:bg-gray-900 font-bold">üñ®Ô∏è Imprimir</button>
                            </div>
                        </div>

                        <div className="sheets-container">
                            <div className="page-a4">
                                {processing.active && <div className="loading-overlay"><div className="spinner"></div><div className="font-bold text-blue-600">{processing.msg}</div></div>}
                                
                                <div className="header-custom">
                                    <div className="header-left">
                                        <div className="relative group">
                                            <img src={logos.left} className="logo-img" />
                                            <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={(e)=>handleLogo(e,'left')}/>
                                        </div>
                                        <div className="text-xs">
                                            <div className="font-bold text-sm">EXCMO. AYUNTAMIENTO DE ALICANTE</div>
                                            <div className="font-bold">POLIC√çA LOCAL</div>
                                            <div className="italic">Unidad Judicial de Tr√°fico</div>
                                            <div className="italic">Grupo de An√°lisis Documental</div>
                                        </div>
                                    </div>
                                    <div className="header-right">
                                        <div className="text-xs font-bold flex flex-col items-end">
                                            <div className="text-sm mb-1">Asunto: INMOVILIZACI√ìN / RETIRADA</div>
                                            <div className="flex gap-2 items-baseline">
                                                <span>Expediente Eurocop:</span>
                                                <input className="border-b border-black outline-none w-24 text-right font-mono" value={formData.expediente || ''} onChange={(e)=>handleChange('expediente', e.target.value)} />
                                            </div>
                                            <div className="flex gap-2 items-baseline mt-1">
                                                <span>N.¬∫ Denuncia:</span>
                                                <input className="border-b border-black outline-none w-24 text-right font-mono" value={formData.denuncia || ''} onChange={(e)=>handleChange('denuncia', e.target.value)} />
                                            </div>
                                        </div>
                                        <div className="relative group">
                                            <img src={logos.right} className="logo-img" />
                                            <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={(e)=>handleLogo(e,'right')}/>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-gray-200 border-2 border-black text-center font-black text-sm py-1 mb-2">
                                    ACTA DE INMOVILIZACI√ìN / RETIRADA DE VEH√çCULO
                                </div>

                                <div className="form-container">
                                    <div className="section-header">LUGAR Y FECHA DE LA ACTUACI√ìN</div>
                                    <div className="acta-row">
                                        <div className="field-box" style={{width: '60%', flex: 'none'}}><span className="label">Lugar:</span><AutoInput value={formData.lugar} onChange={(v)=>handleChange('lugar',v)}/></div>
                                        <div className="field-box" style={{width: '25%', flex: 'none'}}><span className="label">Fecha:</span><AutoInput value={formData.fecha} onChange={(v)=>handleChange('fecha',v)} isDate={true}/></div>
                                        <div className="field-box no-border" style={{width: '15%', flex: 'none'}}><span className="label">Hora:</span><AutoInput value={formData.hora} onChange={(v)=>handleChange('hora',v)}/></div>
                                    </div>

                                    <div className="section-header">AGENTES ACTUANTES</div>
                                    <div className="acta-row">
                                        <div className="field-box"><span className="label">NIP:</span><AutoInput value={formData.agente1} onChange={(v)=>handleChange('agente1',v)}/></div>
                                        <div className="field-box"><span className="label">NIP:</span><AutoInput value={formData.agente2} onChange={(v)=>handleChange('agente2',v)}/></div>
                                        <div className="field-box"><span className="label">Indicativo:</span><AutoInput value={formData.indicativo} onChange={(v)=>handleChange('indicativo',v)}/></div>
                                        <div className="field-box no-border"><span className="label">Unidad:</span><AutoInput value={formData.unidad} onChange={(v)=>handleChange('unidad',v)}/></div>
                                    </div>

                                    <div 
                                        className={`drop-zone-vehicle ${dragTarget === 'vehicle' ? 'drag-active' : ''}`}
                                        onDragOver={(e)=>{e.preventDefault(); setDragTarget('vehicle')}}
                                        onDragLeave={()=>setDragTarget(null)}
                                        onDrop={(e)=>handleDrop(e, 'vehicle')}
                                        onContextMenu={(e)=>{e.preventDefault(); pasteImage('vehicle')}}
                                    >
                                        <div className="section-header">
                                            DATOS DEL VEH√çCULO <span className="ia-badge no-print">Arrastra Ficha T√©cnica (AZUL)</span>
                                        </div>
                                        <div className="acta-row">
                                            <div className="field-box" style={{width: '25%'}}><span className="label">Marca:</span><AutoInput value={formData.marca} onChange={(v)=>handleChange('marca',v)}/></div>
                                            <div className="field-box" style={{width: '25%'}}><span className="label">Modelo:</span><AutoInput value={formData.modelo} onChange={(v)=>handleChange('modelo',v)}/></div>
                                            <div className="field-box" style={{width: '20%'}}><span className="label">Matr√≠cula:</span><AutoInput value={formData.matricula} onChange={(v)=>handleChange('matricula',v)}/></div>
                                            <div className="field-box no-border" style={{width: '30%'}}><span className="label">VIN:</span><AutoInput value={formData.vin} onChange={(v)=>handleChange('vin',v)}/></div>
                                        </div>
                                    </div>

                                    <div
                                        className={`drop-zone-person ${dragTarget === 'person' ? 'drag-active' : ''}`}
                                        onDragOver={(e)=>{e.preventDefault(); setDragTarget('person')}}
                                        onDragLeave={()=>setDragTarget(null)}
                                        onDrop={(e)=>handleDrop(e, 'person')}
                                        onContextMenu={(e)=>{e.preventDefault(); pasteImage('person')}}
                                    >
                                        <div className="section-header flex justify-between">
                                            <div>DATOS DEL IMPLICADO <span className="ia-badge no-print">Arrastra DNI/Permiso (VERDE)</span></div>
                                            <div className="flex gap-3 font-normal normal-case px-2">
                                                <div className="flex gap-1 cursor-pointer" onClick={()=>toggle('is_conductor')}><div className="custom-box">{formData.is_conductor?'X':''}</div> Conductor</div>
                                                <div className="flex gap-1 cursor-pointer" onClick={()=>toggle('is_titular')}><div className="custom-box">{formData.is_titular?'X':''}</div> Titular</div>
                                            </div>
                                        </div>
                                        <div className="acta-row">
                                            <div className="field-box" style={{width:'80%', flex: 'none'}}><span className="label">Nombre y Apellidos:</span><AutoInput value={formData.nombre} onChange={(v)=>handleChange('nombre',v)}/></div>
                                            <div className="field-box no-border" style={{width:'20%', flex: 'none'}}><span className="label">DNI/NIE:</span><AutoInput value={formData.dni} onChange={(v)=>handleChange('dni',v)}/></div>
                                        </div>
                                        <div className="acta-row">
                                            <div className="field-box" style={{width: '20%', flex: 'none'}}><span className="label">Fecha Nac.:</span><AutoInput value={formData.nacimiento} onChange={(v)=>handleChange('nacimiento',v)} isDate={true}/></div>
                                            <div className="field-box" style={{width: '20%', flex: 'none'}}><span className="label">Tel√©fono:</span><AutoInput value={formData.telefono} onChange={(v)=>handleChange('telefono',v)}/></div>
                                            <div className="field-box no-border" style={{flex: 1}}><span className="label">Domicilio:</span><AutoInput value={formData.domicilio} onChange={(v)=>handleChange('domicilio',v)}/></div>
                                        </div>
                                        <div className="acta-row">
                                            <div className="field-box"><span className="label">Municipio:</span><AutoInput value={formData.municipio} onChange={(v)=>handleChange('municipio',v)}/></div>
                                            <div className="field-box no-border"><span className="label">Provincia:</span><AutoInput value={formData.provincia} onChange={(v)=>handleChange('provincia',v)}/></div>
                                        </div>
                                    </div>

                                    <div className="section-header">ACTUACI√ìN PRACTICADA</div>
                                    <div className="actuacion-grid">
                                        
                                        {/* COLUMNA IZQUIERDA: CAUSAS + FOTO EVIDENCIA */}
                                        <div className="left-column-content">
                                            <div className="motivos-container">
                                                <p className="mb-2 font-bold text-[10px]">Se procede a la INMOVILIZACI√ìN / RETIRADA del veh√≠culo por:</p>
                                                <div className="checkbox-grid">
                                                    <div className="checkbox-row" onClick={()=>toggle('c_seguro')}><div className="custom-box">{formData.c_seguro?'X':''}</div> Carecer de Seguro Obligatorio.</div>
                                                    <div className="checkbox-row" onClick={()=>toggle('c_permiso_con')}><div className="custom-box">{formData.c_permiso_con?'X':''}</div> Carecer de autorizaci√≥n (Conductor).</div>
                                                    <div className="checkbox-row" onClick={()=>toggle('c_permiso_veh')}><div className="custom-box">{formData.c_permiso_veh?'X':''}</div> Carecer de autorizaci√≥n (Veh√≠culo).</div>
                                                    <div className="checkbox-row" onClick={()=>toggle('c_residencia')}><div className="custom-box">{formData.c_residencia?'X':''}</div> No acreditar residencia legal (Art 87.5).</div>
                                                    <div className="flex gap-2 items-center mt-1 mb-2">
                                                        <div className="custom-box cursor-pointer shrink-0" onClick={()=>toggle('c_otro')}>{formData.c_otro?'X':''}</div>
                                                        <span className="whitespace-nowrap font-bold">Otros:</span>
                                                        <input className="border-b border-black w-full text-xs outline-none bg-transparent" value={formData.otro_motivo||''} onChange={(e)=>handleChange('otro_motivo',e.target.value)}/>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* ZONA EVIDENCIA (IZQUIERDA) - ALTURA FIJA PARA EVITAR DESBORDAMIENTO */}
                                            <div 
                                                className={`evidence-zone-left ${dragTarget === 'evidence' ? 'drag-active' : ''}`}
                                                onDragOver={(e)=>{e.preventDefault(); setDragTarget('evidence')}}
                                                onDragLeave={()=>setDragTarget(null)}
                                                onDrop={(e)=>handleDrop(e, 'evidence')}
                                                onContextMenu={(e)=>{e.preventDefault(); pasteImage('evidence')}}
                                                onClick={handleEvidenceClick}
                                            >
                                                {/* BOT√ìN ELIMINAR FOTO */}
                                                {formData.evidence_image && (
                                                    <button 
                                                        onClick={deleteEvidence}
                                                        className="absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold hover:bg-red-700 z-10 no-print shadow-md"
                                                        title="Eliminar foto"
                                                    >X</button>
                                                )}

                                                {formData.evidence_image ? 
                                                    <img src={formData.evidence_image} className="evidence-img" /> : 
                                                    <div className="evidence-placeholder-container">
                                                        <div className="evidence-placeholder no-print">FOTO EVIDENCIA<br/>(Arrastrar/Pegar)</div>
                                                    </div>
                                                }
                                                <input type="file" id="evidenceInput" className="hidden" accept="image/*" onChange={handleEvidenceFile}/>
                                            </div>
                                        </div>

                                        {/* COLUMNA DERECHA: TASAS */}
                                        <div className="right-column-container">
                                            <div className="tasas-box">
                                                {/* TASA INMOVILIZACI√ìN */}
                                                <div className="font-bold underline text-center mb-2">TASA INMOVILIZACI√ìN</div>
                                                <div className="w-full text-center mb-3 pb-3 border-b border-gray-400">
                                                    <strong>53,05 Euros</strong>
                                                </div>

                                                {/* TASAS ESTANCIA */}
                                                <div className="font-bold underline text-center mb-2">TASAS DE ESTANCIA</div>
                                                <div className="flex flex-col gap-2 w-full text-center">
                                                    {/* SIN BORDES INTERMEDIOS */}
                                                    <div className="pb-0.5"><strong>Motos:</strong> 10,61 ‚Ç¨/d√≠a</div>
                                                    <div className="pb-0.5"><strong>&lt; 1500 kg:</strong> 21,22 ‚Ç¨/d√≠a</div>
                                                    <div><strong>&gt; 1500 kg:</strong> 31,83 ‚Ç¨/d√≠a</div>
                                                </div>
                                                
                                                <div className="text-[8px] text-gray-600 italic text-center mt-auto pt-2">* Tarifas vigentes ordenanza fiscal.</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="section-header">DESTINO DEL VEH√çCULO / LUGAR DE INMOVILIZACI√ìN</div>
                                    
                                    <div className="bottom-section">
                                        <div className="bottom-left">
                                            <div className="p-2 border-b border-ccc text-xs">
                                                <div className="flex items-center gap-2 mb-1 w-full">
                                                    <span className="font-bold whitespace-nowrap">Lugar de traslado / dep√≥sito:</span>
                                                    <input className="border-b border-black w-full outline-none font-mono" value={formData.destino_texto||''} onChange={(e)=>handleChange('destino_texto',e.target.value)}/>
                                                </div>
                                                <div className="flex items-center gap-2 w-full">
                                                    <div className="flex gap-1 items-center cursor-pointer whitespace-nowrap font-bold" onClick={()=>toggle('is_privado')}>
                                                        <div className="custom-box">{formData.is_privado?'X':''}</div> 
                                                        Inmovilizaci√≥n en propiedad privada / Otro lugar:
                                                    </div>
                                                    <input className="border-b border-black w-full outline-none" placeholder="Direcci√≥n..." value={formData.lugar_privado||''} onChange={(e)=>handleChange('lugar_privado',e.target.value)}/>
                                                </div>
                                            </div>
                                            <div className="p-1 flex-grow">
                                                <span className="font-bold text-[10px]">Observaciones:</span>
                                                <textarea className="w-full h-full resize-none text-xs outline-none bg-transparent" value={formData.obs||''} onChange={(e)=>handleChange('obs',e.target.value)}></textarea>
                                            </div>
                                        </div>
                                        
                                        <div className="bottom-right-logo group" onClick={()=>document.getElementById('locInput').click()}>
                                            {logos.ubicacion ? 
                                                <img src={logos.ubicacion} className="location-img" /> :
                                                <div className="text-[9px] text-gray-400 no-print border border-dashed px-2">Logo Ubicaci√≥n</div>
                                            }
                                            <div className="location-text">UBICACI√ìN DEL DEP√ìSITO</div>
                                            <input type="file" id="locInput" className="hidden" onChange={(e)=>handleLogo(e, 'ubicacion')}/>
                                        </div>
                                    </div>

                                    <div className="flex border-b border-black h-12">
                                        <div className="flex-1 border-r border-black p-1 relative"><span className="font-bold text-[9px]">Firma Conductor / Titular:</span></div>
                                        <div className="flex-1 border-r border-black p-1 relative"><span className="font-bold text-[9px]">Agente {formData.agente1}:</span></div>
                                        <div className="flex-1 p-1 relative"><span className="font-bold text-[9px]">Agente {formData.agente2}:</span></div>
                                    </div>

                                    <div className="bg-gray-100 p-2 text-[9px] border-b border-black">
                                        <div className="font-bold underline mb-1">DILIGENCIA DE ENTREGA Y TRASLADO A PROPIEDAD PRIVADA:</div>
                                        <div className="mb-2 text-justify leading-snug">
                                            Siendo las <DottedInput width="50px" value={formData.lev_hora} onChange={(v)=>handleChange('lev_hora',v)}/> horas del d√≠a <DottedInput width="80px" value={formData.lev_fecha} onChange={(v)=>handleChange('lev_fecha',v)}/>, se procede al levantamiento de la misma o cambio de destino a Propiedad Privada y haciendo entrega del veh√≠culo a:
                                        </div>
                                        <div className="flex gap-2 items-end">
                                            <span className="font-bold">D./D√±a:</span>
                                            <input className="dotted-line flex-1 bg-transparent outline-none border-b-0" style={{borderBottom: '1px dotted black'}} value={formData.lev_nombre||''} onChange={(e)=>handleChange('lev_nombre',e.target.value)}/>
                                            <div className="border border-black w-32 h-8 relative bg-white"><span className="absolute top-0 left-1 text-[7px]">Firma Recib√≠:</span></div>
                                        </div>
                                    </div>
                                    
                                    <div className="p-2 text-[8px] text-justify text-gray-600">
                                        <strong>Nota informativa sobre tratamiento de residuo s√≥lido urbanos:</strong><br/>
                                        Se hace constar en virtud de la presente que, transcurridos <strong>DOS MESES</strong> desde la fecha, si no se ha procedido a la retirada del veh√≠culo del dep√≥sito municipal (una vez subsanadas las causas que motivaron la medida cautelar) de conformidad con lo dispuesto en el Art. 71.1 a) del Texto articulado de la Ley sobre Tr√°fico, Circulaci√≥n de Veh√≠culos y Seguridad Vial, aprobado por R.D Legislativo 229/1990, de 2 de marzo, Ley 11/99, de 21 de abril de modificaci√≥n de la Ley Reguladora de las Bases de R√©gimen Local, y normativa complementaria, en su caso SE PROCEDER√Å A DARLE TRATAMIENTO DE RESIDUO S√ìLIDO URBANO (Ley 10/2000, de 12 diciembre, de Residuos de la C. Valenciana).
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>