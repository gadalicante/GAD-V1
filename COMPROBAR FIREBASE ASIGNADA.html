<!DOCTYPE html>
<html>
<head>
    <title>Explorador databaseURL - Soluci√≥n Mejorada</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 900px;
            margin: 0 auto;
        }
        h1 { color: #2c3e50; text-align: center; }
        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #ecf0f1;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s;
        }
        .upload-area:hover {
            background: #d6eaf8;
            border-color: #2980b9;
        }
        .upload-area.dragover {
            background: #2ecc71;
            border-color: #27ae60;
        }
        button { 
            padding: 12px 25px; 
            margin: 10px 5px; 
            cursor: pointer; 
            border: none;
            border-radius: 5px;
            font-size: 16px;
            background: #3498db;
            color: white;
        }
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        #resultados { 
            margin-top: 30px; 
            padding: 20px;
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .archivo {
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .archivo-con {
            background: #e8f5e8;
            border-left-color: #27ae60;
        }
        .archivo-sin {
            background: #f5e8e8;
            border-left-color: #e74c3c;
        }
        .url-line {
            font-family: 'Courier New', monospace;
            background: #2c3e50;
            color: white;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-top: 5px;
            display: inline-block;
        }
        .estadisticas {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .stat {
            padding: 12px 18px;
            border-radius: 5px;
            font-weight: bold;
            flex: 1;
            text-align: center;
        }
        .verde { background: #d4edda; color: #155724; }
        .rojo { background: #f8d7da; color: #721c24; }
        .azul { background: #d1ecf1; color: #0c5460; }
        .seccion {
            margin: 25px 0;
            padding: 15px;
            border-left: 4px solid #3498db;
            background: white;
        }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; }
        .exito { background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; }
        .progreso { text-align: center; padding: 20px; color: #3498db; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç EXPLORADOR databaseURL - SOLUCI√ìN MEJORADA</h1>
        <p><strong>Selecciona TODOS los archivos HTML de tu carpeta:</strong></p>
        
        <div class="upload-area" id="uploadArea">
            <h2>üìÅ Arrastra y suelta archivos HTML aqu√≠</h2>
            <p>O haz clic para seleccionar archivos</p>
            <p><small>Selecciona m√∫ltiples archivos HTML (.html, .htm) manteniendo presionado Ctrl</small></p>
            <input type="file" id="archivosInput" multiple accept=".html,.htm" style="display: none;">
        </div>

        <button onclick="explorarArchivos()" id="explorarBtn" disabled>üîç Explorar Archivos Seleccionados</button>
        <button onclick="limpiarTodo()">üóëÔ∏è Limpiar Todo</button>
        
        <div id="contadorArchivos" style="margin: 10px 0; font-weight: bold;"></div>
        
        <div id="resultados">
            <p>Selecciona los archivos HTML primero</p>
        </div>
    </div>

    <script>
        let archivosSeleccionados = [];

        // Configurar √°rea de upload
        const uploadArea = document.getElementById('uploadArea');
        const archivosInput = document.getElementById('archivosInput');
        const explorarBtn = document.getElementById('explorarBtn');
        const contadorArchivos = document.getElementById('contadorArchivos');

        uploadArea.addEventListener('click', () => {
            archivosInput.click();
        });

        // Arrastrar y soltar
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            manejarArchivos(e.dataTransfer.files);
        });

        // Selecci√≥n manual
        archivosInput.addEventListener('change', (e) => {
            manejarArchivos(e.target.files);
        });

        function manejarArchivos(files) {
            const archivosHTML = Array.from(files).filter(archivo => 
                archivo.name.toLowerCase().endsWith('.html') || 
                archivo.name.toLowerCase().endsWith('.htm')
            );

            if (archivosHTML.length === 0) {
                alert('‚ùå No se encontraron archivos HTML (.html o .htm) en la selecci√≥n');
                return;
            }

            archivosSeleccionados = archivosHTML;
            explorarBtn.disabled = false;
            contadorArchivos.innerHTML = `üìÅ Archivos seleccionados: ${archivosHTML.length} archivo(s) HTML`;
            contadorArchivos.style.color = '#27ae60';

            document.getElementById('resultados').innerHTML = 
                `<p>‚úÖ ${archivosHTML.length} archivo(s) HTML listos para analizar. Haz clic en "Explorar Archivos Seleccionados"</p>`;
        }

        function explorarArchivos() {
            if (archivosSeleccionados.length === 0) {
                alert('Primero selecciona algunos archivos HTML');
                return;
            }

            const resultados = document.getElementById('resultados');
            resultados.innerHTML = '<div class="progreso">üîç Analizando archivos...</div>';

            let conDatabaseURL = 0;
            let sinDatabaseURL = 0;
            let listaConURL = '';
            let listaSinURL = '';
            let archivosProcesados = 0;

            archivosSeleccionados.forEach(archivo => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    archivosProcesados++;
                    const contenido = e.target.result;
                    
                    // Buscar databaseURL
                    const regex = /databaseURL:\s*[^\r\n]+/g;
                    const tieneDatabaseURL = regex.test(contenido);
                    
                    if (tieneDatabaseURL) {
                        conDatabaseURL++;
                        const match = contenido.match(/databaseURL:\s*[^\r\n]+/);
                        listaConURL += `<div class="archivo archivo-con">
                            <strong>‚úÖ ${archivo.name}</strong><br>
                            <span class="url-line">${match[0]}</span>
                        </div>`;
                    } else {
                        sinDatabaseURL++;
                        listaSinURL += `<div class="archivo archivo-sin">‚ùå ${archivo.name}</div>`;
                    }

                    // Actualizar cuando todos est√©n procesados
                    if (archivosProcesados === archivosSeleccionados.length) {
                        mostrarResultadosFinales();
                    }
                };

                reader.onerror = function() {
                    archivosProcesados++;
                    sinDatabaseURL++;
                    listaSinURL += `<div class="archivo archivo-sin">‚ùå ${archivo.name} (error al leer)</div>`;
                    
                    if (archivosProcesados === archivosSeleccionados.length) {
                        mostrarResultadosFinales();
                    }
                };

                reader.readAsText(archivo);
            });

            function mostrarResultadosFinales() {
                resultados.innerHTML = `
                    <h3>üìä RESULTADO DEL AN√ÅLISIS</h3>
                    <div class="estadisticas">
                        <div class="stat verde">üü¢ CON databaseURL: ${conDatabaseURL}</div>
                        <div class="stat rojo">üî¥ SIN databaseURL: ${sinDatabaseURL}</div>
                        <div class="stat azul">üìÅ TOTAL: ${archivosSeleccionados.length}</div>
                    </div>
                    
                    ${conDatabaseURL > 0 ? `
                    <div class="seccion">
                        <h4>üìÑ ARCHIVOS CON databaseURL (${conDatabaseURL}):</h4>
                        ${listaConURL}
                    </div>
                    ` : '<div class="error">‚ùå No se encontr√≥ databaseURL en ning√∫n archivo</div>'}
                    
                    ${sinDatabaseURL > 0 ? `
                    <div class="seccion">
                        <h4>üìÑ ARCHIVOS SIN databaseURL (${sinDatabaseURL}):</h4>
                        ${listaSinURL}
                    </div>
                    ` : ''}
                `;
            }
        }

        function limpiarTodo() {
            archivosSeleccionados = [];
            archivosInput.value = '';
            explorarBtn.disabled = true;
            contadorArchivos.innerHTML = '';
            document.getElementById('resultados').innerHTML = '<p>Selecciona los archivos HTML primero</p>';
        }

        function mostrarInstrucciones() {
            alert(`INSTRUCCIONES:

1. Haz clic en el √°rea azul o arrastra archivos
2. Selecciona M√öLTIPLES archivos HTML (mant√©n Ctrl presionado)
3. Haz clic en "Explorar Archivos Seleccionados"
4. Ver√°s qu√© archivos tienen databaseURL

üí° TIP: Para seleccionar todos los HTML de una carpeta:
   - Abre la carpeta en el Explorador de Windows
   - Ordena por tipo
   - Selecciona todos los .html (Ctrl + A si solo hay HTML)`);
        }

        // Mostrar instrucciones al cargar
        setTimeout(mostrarInstrucciones, 1000);
    </script>
</body>
</html>